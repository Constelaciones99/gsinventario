<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>INVENTARIO</title>
  <style>
    @font-face {
      font-family: avigea;
      src: url(./src/styles/fuentes/Avigea.ttf);
    }
    @font-face {
      font-family: basilik;
      src: url(./src/styles/fuentes/basilik.ttf);
    }
    @font-face {
      font-family: bohemian;
      src: url(./src/styles/fuentes/bohemian.otf);
    }
    @font-face {
      font-family: carena;
      src: url(./src/styles/fuentes/carena.otf);
    }
    body, html {
      margin: 0;
      padding: 5px 0px 15px 0px ;
      height: 100vh;
      overflow: hidden;
    }
    .full-height {
      height: 100vh;
    }
    .section {
      flex: 1;
      padding: 0.5rem;
    }
    .img-btn {
      width: 7.5em;
      border-radius: 0.5rem;
      margin: 0px 25px;
      cursor: pointer;
    }

    .img-group {
      gap: 1rem;
      display: flex;
    }
    dialog {
      border: none;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    #verTodo{
            border: 2px solid #242424;
            width: auto;
            border-radius: 20px;
            transition: scale  1s;
            text-decoration: none;
            color: #242424;
        }
        #verTodo:hover{
            scale: 1.02;
            cursor: pointer;
        }

    @media (min-width: 992px) {
      .layout {
        flex-direction: row;
      }
      .img-group {
        flex-direction: column;
        align-items: center;
      }
      .img-btn {
        width: 9em;
      }
    }

    li{
      list-style: none;
    }

    @media (max-width: 991.98px) {
      .layout {
        flex-direction: column;
      }
      .img-group {
        flex-direction: row;
        justify-content: center;
      }
    }

    #titulo_pagina{
      font-family: carena;
      font-size: 3.4rem;
      color: #6b9ac4;
    }

    @keyframes dancing{
      40%{
        scale: 1.025s;
      }
      50%{
        scale: 1.05;
      }
    }

    #seccion{
      background: linear-gradient(90deg, #fff, cornsilk, #fff);
    }

  </style>
</head>
<body>
  <div class="container d-flex flex-column full-height rounded-5" >
    <!-- Header -->
    <header class=" text-center py-2">
      <div class="d-flex justify-content-center align-items-center">
        
        <h5 class="m-0 text-warning" id="titulo_pagina">Materiales</h5>
      </div>
    </header>
    <!-- Cuerpo principal -->
    <div class="flex-grow-1 d-flex layout" id="seccion">

      <!-- Secci√≥n Izquierda -->
      <div class="section d-flex flex-column align-items-center justify-content-center">
        <div class="img-group">
          <img src="./src/styles/img/buscare.png" style="animation: dancing 1.5s ease-out infinite;" class="img-btn"  data-img="buscar">
          <img src="./src/styles/img/agregar-producto.png" style="animation: dancing  1.5s .2s ease-out infinite;" data-img="agregar" class="img-btn" >
        </div>
      </div>

      <!-- Secci√≥n Central -->
      <div class="section d-flex flex-column align-items-center justify-content-center text-center">
        <img src="./src/styles/img/inventario.png" style="animation: dancing 1.5s .8s ease-out infinite;" class="img-btn mb-2 bg-transparent border-0" data-img="ver Todo">
        <a href="./screens/inventario.html" class="fw-bold fs-6 text-dark bg-warning px-2 py-1 rounded" id="verTodo">VER INVENTARIO</a>
        <p class="mt-1" id="descripcion">...</p>
      </div>

      <!-- Secci√≥n Derecha -->
      <div class="section d-flex flex-column align-items-center justify-content-center">
        <div class="img-group">
          <img src="./src/styles/img/devolucion-de-producto.png" style="animation: dancing 1.5s .4s ease-out infinite;" data-img="editar" class="img-btn" onclick="abrirDialog('editar')">
          <img src="./src/styles/img/eliminar-producto.png" style="animation: dancing 1.5s .6s ease-out infinite;" data-img="eliminar" class="img-btn" onclick="abrirDialog('eliminar')">
        </div>
      </div>
    </div>

    <!-- DIALOGOS -->

    <!-- BUSCAR -->
    <dialog id="dialog-buscar">

        <p class="fs-4 fw-bold">üîç BUSCAR PRODUCTO</p>
      <input type="text" class="form-control mb-2" id="text_prod"  placeholder="ID o nombre del producto">
      <div class="text-end">
        <button class="btn btn-secondary" data-cerrar="buscar" id="cerrarDialog">Cancelar</button>
        <button class="btn btn-warning text-dark" id="btnQuerySearch">Buscar</button>
      </div>

    </dialog>

  <!-- AGREGAR -->
    <dialog id="dialog-agregar" class="w-75">
      <form class="" enctype="multipart/form-data" id="form-agregar">
                    <h5 class="fw-bold text-center">AGREGAR PRODUCTO</h5>
                    <hr>
                       <input type='text' name='id_prod' class='form-control mb-2 fw-bold' value="PROD-001" disabled>
                    <label>Seleccionar producto:</label>
                    <select class="form-select mb-2"  id="select_producto-prod" name="select_prod">
                    <option value="">--Seleccionar--</option>
                    <option>mouse</option>
                    <option>teclado</option>
                    <option>audifono</option>
                    <option>pantalla</option>
                    <option>cable VGA</option>
                    <option>cable HDMI</option>
                    <option>FUENTE</option>
                    <option>memoria RAM</option>
                    <option>equipo</option>
                    <option>Repetidor</option>
                    </select>
                    
                    <input type="text" class="form-control mb-2" placeholder="| Producto" id="item-producto" name="name_prod">
                    <hr>
                    <input type="number" class="form-control mb-2" required placeholder="| Cantidad" min="0" name="cantidad">
                    <input type="text" class="form-control mb-2" placeholder="| Marca" name="marca" id="marca_producto">
                    <hr>
                    <input type="text" id="selects" name="categoriastodas" hidden>
                    <ul id="lista">
                    <li><input type="checkbox" class="cat" data-categoria="periferico de entrada">periferico de entrada</li>
                    <li><input type="checkbox" class="cat" data-categoria="periferico de salida">periferico de salida</li>
                    <li><input type="checkbox" class="cat" data-categoria="componente externo">componente externo</li>
                    <li><input type="checkbox" class="cat" data-categoria="componente interno">componente interno</li>
                    <li><input type="checkbox" class="cat" data-categoria="dispositivo de almacenamiento">dispositivo de almacenamiento </li>
                    <li><input type="checkbox" class="cat" data-categoria="conector">conector </li>
                    <li><input type="checkbox" class="cat" data-categoria="dispositivo de red">dispositivo de red </li>
                    <li><input type="checkbox" class="cat" data-categoria="adaptador">adaptador </li>
                    </ul>

                    <hr>
                    <label>Detalles:</label>
                    <textarea class="form-control mb-2" placeholder="-Asignado a usuario..." name="detalles" id="text-detalles"></textarea>
                    <label>Observaciones:</label>
                    <textarea class="form-control mb-2" placeholder="-Tiene el cable pelado" name="observaciones" id="text-observaciones"></textarea>
                    <div class="d-flex justify-content-end mb-2">
                      <hr>
                    <!-- <button class="btn btn-success"></button> name_prod-->
                     <input type="file" value="AGREGAR FOTO üì∑" class="btn btn-success" id="inptFile" name="foto">
                    <hr>
                    </div>
                    <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-secondary me-2" data-cerrar="agregar" id="cerrarDialog">‚¨ÖÔ∏èCANCELAR</button>
                    <!-- <button type="submit" class="btn btn-warning text-dark">üíæGUARDAR</button> -->
                     <input type="submit" class="btn btn-warning text-dark" id="guardarProd" value="üíæGUARDAR">
                    </div>
        </form>
    </dialog>

    <!-- EDITAR -->

    <dialog id="dialog-editar" >
      <p class="fs-4 fw-bold">‚úèÔ∏è EDITAR PRODUCTO</p>
      <input type="text" class="w-100 mb-2 fs-5 ps-2"  id="id_prod_edit" disabled value="ID">
      <select class="form-select mb-2" id="ListProd">
        <option>sin conexion</option>
      </select>
      <select class="form-select mb-2" id="ListProp" disabled>
        <option>nombre</option>
        <option>marca</option>
        <option>cantidad</option>
        <option>detalles</option>
        <option>observacion</option>

      </select>
      <input type="text" class="form-control mb-2" id="newValue" placeholder="Nuevo valor">
      <div class="text-end">
        <button class="btn btn-secondary" id="cerrarDialog" data-cerrar="editar">Cancelar</button>
        <button class="btn btn-primary" id="btnUpdate">Actualizar</button>
      </div>
    </dialog>

    <!-- ELIMINAR -->

    <dialog id="dialog-eliminar">
      <p class="fs-4 fw-bold text-danger">üóëÔ∏è ELIMINAR PRODUCTO</p>
      <select class="form-select mb-2" id="prodEliminar">
        <option>Producto 1</option>
        <option>Producto 2</option>
      </select>
      <div class="text-end">
        <button class="btn btn-secondary" id="cerrarDialog" data-cerrar="eliminar">Cancelar</button>
        <button class="btn btn-danger" id="deleteProd">Eliminar</button>
      </div>
    </dialog>

  </div>

  <script type="module" src="./config/index.js"></script>

  <script type="module">
      import {obtenerProd, listaProd, eliminarProd, db} from './config/firebase.js'
      import {doc, updateDoc, getDoc} from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js'

      var cb_productos_edit=document.getElementById("ListProd")
      var cb_propiedades_edit=document.getElementById("ListProp")
      var cb_productos_eliminar=document.getElementById("prodEliminar")
      var btnDelProd=document.getElementById("deleteProd")
      var nombre_producto=document.getElementById("item-producto")
      var select_producto=document.getElementById("select_producto-prod")
      var items=document.getElementById("selects")
      var title_prod=document.getElementById("id_prod_edit")
      var newValueProd=document.getElementById("newValue")
      var description=document.getElementById("descripcion")
      var keyNameProd=document.getElementById("text_prod")
      var btnSearchProd=document.getElementById("btnQuerySearch")
      var marcaProducto=document.getElementById("marca_producto")
      var txt_detalles=document.getElementById("text-detalles")
      var txt_observa=document.getElementById("text-observaciones")

      var prodLocal={
            id:"",
            nombre:"",
            marca:"",
            cantidad:"",
            categoria:"",
            imagenes:"",
            observacion:"",
            fecha:""
      }

      btnSearchProd.addEventListener("click", function(){
          listaProd((querySnapshot)=>{
            querySnapshot.forEach(doc =>{
                  if(doc.data().nombre.trim().toLowerCase()==keyNameProd.value.trim().toLowerCase()){
                  prodLocal={
                    id:doc.id,
                    nombre:doc.data().nombre,
                    marca:doc.data().marca,
                    cantidad:doc.data().cantidad,
                    categoria:doc.data().categoria,
                    imagenes:doc.data().imagenes,
                    detalles:doc.data().detalles,
                    observacion:doc.data().observacion,
                    fecha:doc.data().fecha
              }
              localStorage.setItem("producto",JSON.stringify(prodLocal))
              window.location.href="./screens/resultado.html"
                }
            })
            if(prodLocal.nombre==""){
              alert("Producto no econtrado: "+keyNameProd.value)
            }
          })

      })

      document.getElementById("guardarProd").addEventListener("click",function(){
              items.value=JSON.stringify(["sin categorias"])
            var categorias=[]
            document.querySelectorAll(".cat").forEach((cb)=>{
                      if(cb.checked){
                        categorias.push(cb.dataset.categoria)
                      }
                    })
                    if(categorias.length==0){
                      items.value=JSON.stringify(["sin categorias"])
                    }else{
                      items.value=JSON.stringify(categorias)
                    }
            /**/
            if(marcaProducto.value==""){
              marcaProducto.value="Sin marca"
            }
            if(txt_detalles.value==""){
              txt_detalles.value="sin detalles"
            }
            if(txt_observa.value==""){
              txt_observa.value="sin observaciones"
            }

            if(!document.getElementById("inptFile").files[0]){
              alert("no se encontr√≥ imagenes")
              document.getElementById("inptFile").files[0]="https://firebasestorage.googleapis.com/v0/b/inventary-74f46.firebasestorage.app/o/productos%2Fimagen.png?alt=media&token=431dfccd-538f-4e03-a6af-80316eb97ad4"
            }
      })

      

      window.addEventListener("DOMContentLoaded", function(){
        listaProd((querySnapshot)=>{
          cb_productos_edit.innerHTML="<option selected disabled>--Selecciona Producto--</option>"
          cb_productos_eliminar.innerHTML="<option selected disabled>--Selecciona Producto--</option>"
            querySnapshot.forEach(doc =>{
                cb_productos_edit.innerHTML +=`
                  <option data-identy=${doc.id}>${doc.data().nombre}</option>
                `
                cb_productos_eliminar.innerHTML +=`
                <option data-delete=${doc.id}>${doc.data().nombre}</option>
                `
            });
      })

      })

      cb_productos_edit.addEventListener("change",function(){
              title_prod.value=cb_productos_edit.selectedOptions[0].dataset.identy
              cb_propiedades_edit.disabled=false
      })


      /*PARA ABRIR UN MODAL*/
      document.querySelectorAll(".img-btn").forEach((elemento)=>{
            elemento.addEventListener("click",function(evt){
                document.getElementById(`dialog-${evt.target.dataset.img}`).showModal();
            })
      })
      /*PARA CERRAR UN MODAL*/
      document.querySelectorAll("#cerrarDialog").forEach((elementor)=>{
            elementor.addEventListener("click",function(evt){
                document.getElementById(`dialog-${evt.target.dataset.cerrar}`).close();
            })
      })

      select_producto.addEventListener("change",function(){
                    if(select_producto.selectedIndex>0){
                        nombre_producto.value=""
                        nombre_producto.disabled=true
                    }else{
                        nombre_producto.disabled=false
                    }
        })

      var btnDelProd=document.getElementById("deleteProd").addEventListener("click", function(){
              listaProd((querySnapshot)=>{
                //limpiar campos
                  querySnapshot.forEach(doc =>{
                    if(doc.data().nombre==cb_productos_eliminar.value){
                      var conquest= confirm("Seguro que deseas eliminar este Producto?")
                      if(conquest){
                        eliminarProd(doc.id)
                        alert("Producto eliminado!")
                              }
                            }
                          })
                        })
                      })

      document.getElementById("btnUpdate").onclick=async ()=>{
              var props=[
                {nombre:"Alina"},
                {marca:"xd"},
                {cantidad:1},
                {detalles:"Sin detalles"},
                {observacion:"Sin observaciones"}
                  ]

              props[cb_propiedades_edit.selectedIndex][cb_propiedades_edit.value]=newValueProd.value

              try{
                const docRef=doc(db,"prueba",title_prod.value)
                await updateDoc(docRef,props[cb_propiedades_edit.selectedIndex])
                title_prod.value="ID"
                newValueProd.value=""
              cb_propiedades_edit.disabled=true
                alert("Producto Editado!")
              }catch(error){
                 // alert(error)throw nombre_producto
              }
                      
      }

      /* Mostrar la operacion en un span cuando se pasa el mouse */
        
       document.body.addEventListener("mouseover",opc=>{
                if(!opc.target.dataset.img)return
                description.textContent=opc.target.dataset.img
            })


  </script>
</body>
</html>



<!-- rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAdmin;
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
} -->

