<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <title>Document</title>
</head>
        <style>
              @font-face {
            font-family: printer;
            src: url(./../src/styles/fuentes/printer.ttf);
        }
        @font-face {
            font-family: Monaco;
            src: url(./../src/styles/fuentes/Monaco.ttf);
        }

        colores{
          colores:--var(
            #d9ed92,
          #b5e48c
          ,#99d98c,
          #76c893,
          #52b69a,
          #34a0a4,
          #168aad,
          #1a759f,
          #1e6091,
          #184e77,#a1ff0a)
        }

        html{
            ::-webkit-scrollbar{
                display: none
            };
        }

        header{
            background: #537c9f;
        }

        .card {
            scale: .97;
            border:#6b9ac4 .5px solid;
        }

        #nombre-productos{
            font-family: arial;
            background: #6b9ac4;
            color: #fff;
            /*box-shadow: 0px 0px .5px .5px #2a6f97 Buscar*/
        }

        label{
            color: #3d5366 !important;
        }

        #btn-eliminar{
            background: #537c9f;
            border: 1px #537c9f solid;
        }
        #btn-editar{
            background: #eff2f1;
            border: 1px #537c9f solid;
        }

        #btn-ver{
            background: #537c9f;
            border:1px #537c9f solid
        }

        #contenidoCargado{
        }

        img{
            cursor: pointer;
            transition: scale .5s;
        }
        img:hover{
            scale: 1.08;
        }
        #titulo-buscar{
            color: #404040;
        }
        input{
            outline: none;
            border:none;
            /*text-transform: capitalize;*/
        }
        dialog{
            border:none;
            border-radius: 10px;
            box-shadow: 0px 0px 5px 1px #242424;
            z-index: 1000; /* Opcional, por si se esconde detr√°s de otros */
        }
        #dialog-editar form input{
            font-size: 16px;
            padding: 3px 5px;
        }

        textarea{
            resize: none;
            line-height: 16px;
            font-size: 15px;
        }
        dialog form input{
            border: .2px solid;
            border-radius: 5px;
        }
        #form-ver{
            line-height: 10px;
        }
        ul li{
            list-style: none;
        }
        #titulo-buscar{
            font-family: printer;
        }
        
        span#eliminar-id{
            text-transform: capitalize;
        }
        #dialog-carrusel {
            width: 70vw;  /* Puedes ajustar el tama√±o que desees */
            height: 50vh;
            max-width: 800px;
            max-height: 600px;
            padding: 0;
        }

        #dialog-carrusel img {
            object-fit: contain;
            width: 100%;
            height: 100%;
        }
        #carousel-inner {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            max-width: 100%;
            padding: 1rem;
        }
        #carousel-inner img {
            object-fit: contain;
            max-height: 150px;
        }
        #cerrar_carrusel{
            cursor: pointer;
            width: 50px;   
            float: left;
        }

        #badge{
            /*box-shadow: 0px 0px 3px .5px #242424;*/
            color:#242424
        }

        #btn-badge{
            scale: .7;
        }

        #changePhoto{
            scale: .6;
        }

        #selectCat, #selectMarc {
            font-size: 1.1em;
            background: #fff;
            border: .2px solid #ddd;
            border-radius: 10px;
            padding: 8px;
            cursor: pointer;
            outline: none;
            appearance: none;
        }

        select option:checked{
            background: #6b9ac4;
        }

        .card{
            background: #fff;
            /*box-shadow:0px 0px 5px 1px #fff,
                        1px -1px 4px .5px #000   ;
            filter:blur(.5px) drop-shadow(0px 1px #ddd)*/
        }
        </style>
<body>

    <div class="container-fluid px-0">
        <header class=" px-5">
            <p class="row">

                <div class="col-12 btn-group w-100">
                    <div class="row">
                        <p class="btn fs-2 text-white col-3 ps-0 ms-0" id="titulo-buscar">üîé </p>
                    </div>
                    <p class="row btn d-flex justify-content-start pe-0">
                        <input type="text" class="ms-0 w-100 col-12 fs-3 rounded-2 pe-1" id="buscador"  placeholder="Nombre de producto, etc.">
                    </p>
                </div>
            </p>
        </header>

        <span class="row w-50 ms-5">

            <span class="col-12 col-md-6 m-1 m-md-0 d-flex justify-content-center align-items-center">
                <label for="filtro1" class="me-2 fw-bold" style=" font-size: 1.2rem;">Categorias: </label>
                <select name="filtro1" id="selectCat">
                    <option value="--Todas las Categorias--" class="mx-5" selected>--Todas las Categorias--</option>
                    <option value="">periferico de entrada</option>
                    <option value="">periferico de salida</option>
                    <option value="">componente externo</option>
                    <option value="">componente interno</option>
                    <option value="">dispositivo de almacenamiento</option>
                    <option value="">conector</option>
                    <option value="">dispositivo de red</option>
                    <option value="">adaptador</option>
                    <option value="">sin categorias</option>
                </select>
            </span>

            <span class="col-12 col-md-6 m-1 m-md-0 d-flex justify-content-center align-items-center">
                
                <input type="checkbox" id="cb_category">Ver todo seg√∫n la categor√≠a
            </span>

        </span>
            <div class="sub-content">
                    <ul id="respuestas">
                    </ul>
            </div>

        <div class="row ms-2 me-2" id="contenidoCargado">
            
        </div>
    </div>

    
    <dialog id="dialog-eliminar">
            <form action="#" class="text-center">
                <span class="confirm-delete-text fs-5">¬øSeguro que deseas <b class="text-danger">eliminar</b> este producto?</span><hr>
                <span id="eliminar-id" class="fw-bold fs-4"></span>|
                <span id="eliminar-nombre" class="fs-5"></span>
                    <hr>
                <span class="d-flex justify-content-center">
                    <button class="btn btn-secondary mx-2" id="cerrarDialogDelete"> CANCELAR</button>
                <button class="btn btn-danger fw-bold" id="btnEliminar">ELIMINAR</button>
                </span>
            </form>
    </dialog>

    <dialog id="dialog-editar">
            <span class="fw-bold">
                üìùEditar Producto 
            </span>
            <form action="#" class="text-center" id="editar-form">
                <hr>
                <h3 id="editar-id">PROD-0004</h3>
                <hr>
                <img src="./../src/styles/img/agotado.png" id="editar-foto" style="width: 5rem;"><br>

                <input type="file"  title="sdad" name="sd" id="changePhoto" value="cambiar foto"><br>
                
                <input type="text" class="mb-1 fs-5 " id="editar-nombre" placeholder="Nombre"><br>
                <input type="text" class="mb-1 fs-5 " id="editar-marca"  placeholder="Marca"><br>
                <input type="number" class="mb-1 fs-5 " id="editar-cantidad"  placeholder="Cantidad"><hr>
                <span id="editar-categorias" class="btn-group">
                     <input type="text" id="selects" name="categoriastodas" hidden>
                    <ul id="lista">
                    <li><input type="checkbox" class="cat" data-categoria="periferico de entrada">periferico de entrada</li>
                    <li><input type="checkbox" class="cat" data-categoria="periferico de salida">periferico de salida</li>
                    <li><input type="checkbox" class="cat" data-categoria="componente externo">componente externo</li>
                    <li><input type="checkbox" class="cat" data-categoria="componente interno">componente interno</li>
                    <li><input type="checkbox" class="cat" data-categoria="dispositivo de almacenamiento">dispositivo de almacenamiento </li>
                    <li><input type="checkbox" class="cat" data-categoria="conector">conector </li>
                    <li><input type="checkbox" class="cat" data-categoria="dispositivo de red">dispositivo de red </li>
                    <li><input type="checkbox" class="cat" data-categoria="adaptador">adaptador </li>
                    </ul>
                </span>
                <hr>
                <span class="vw-100 text-start">Observaciones:</span>
                <textarea name="observacion" id="editar-detalles" class="w-100" placeholder="observaciones"></textarea><br>
                <hr>
                <span class="vw-100 text-start">Detalles:</span>
                <textarea name="detalles" id="editar-observaciones" class="w-100" placeholder="detalles"></textarea><br>
                <hr>
                <button  class="btn btn-secondary" id="cerrarDialogEdit">CERRAR</button>
                <input  class="btn btn-success" id="editBtn" value="GUARDAR CAMBIOS" >
            </form>
    </dialog>

    <dialog id="dialog-ver" class="">
            <span class="ver-producto-texto fw-bold">üïµÔ∏èVer Producto</span>
            <form action="#" id="form-ver" class="text-center">
               <h3 id="ver-id">PROD-0003</h3>
               <hr>
               <img src="./../src/styles/img/agotado.png" id="ver-foto" style="width: 5rem;">
               <hr>
                <input id="ver-nombre" class="fs-4 fw-bold text-center border-0" value="" disabled> <br>
                <input id="ver-marca" class="fs-5 text-center border-0" value="" disabled> <br>
                <input id="ver-cantidad" class="fs-5 text-center border-0" value="" disabled><hr>
                    <span id="ver-categorias"></span>
                <hr>
                <textarea
                 id="ver-detalles" class="border-0 text-center" disabled>*Asignado a todo el personal</textarea
                    ><br>
                <textarea id="ver-observaciones" class="text-center border-0" disabled>*Producto nuevo</textarea>
                <hr>
                <input type="button" class="btn btn-primary fw-bold" value="CERRAR DIALOGO" id="cerrarDialogShow">
            </form>
    </dialog>

    <dialog id="dialog-carrusel">
        <p class="text-end text-secondary me-3 fw-bold fs-3" id="cerrar_carrusel">‚úï</p>   
        <div id="carouselExampleIndicators" class=" carousel slide p-0 m-0">
        <div id="carousel-inner" class="">
            
        </div>
        </div>
    </dialog>

<script type="module">
        import {obtenerProd, listaProd, eliminarProd, db, storage} from './../config/firebase.js'
        import {doc, updateDoc, getDoc} from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js'
        import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";

        var cont=document.getElementById("contenidoCargado")
        var contenido_buscar=document.getElementById("buscador")
        var rptas=document.getElementById("respuestas")
        var slider=document.getElementById("carousel-inner")
        var btnDel=document.getElementById("btnEliminar")
        var closeDialogDel=document.getElementById("cerrarDialogDelete")
        var closeDialogEdit=document.getElementById("cerrarDialogEdit")
        var closeDialogVer=document.getElementById("cerrarDialogShow")
        var btnChangePhoto=document.getElementById("changePhoto")
        var editForm=document.querySelector("#editar-form")
        var btnEditar=document.getElementById("editBtn")
        var cbCategoria=document.getElementById("cb_category")

        var colores=["success","warning","danger","primary","secondary","info","dark"]
        //rut
        window.addEventListener("DOMContentLoaded", resp=>{
            listaProd((querySnapshot)=>{
                 let html=""
                 let value=0 //Cantidad de veces que da una vuelta
                querySnapshot.forEach((doc)=>{
                    html +=`
                    <div class="card col-6 col-md-4 col-lg-3 col-xxl-2 rounded-3" id="card-prod">
                <div class="row d-flex justify-content-center  rounded-2">
                        <span class="
                        rounded-top-2 text-center fw-bold py-1 fs-4" id="nombre-productos"> ${doc.data().nombre} </span>
                        <span id="id_hidden">${doc.id}</span>
                        <img src=${doc.data().imagenes["principal"]} class="py-1" style="width: 8rem;" data-ima="${doc.id}" id="btnImage">
                </div>
                <div class="row rounded-2 p-0">
                    <span class="btn-group">
                        <p class="col-4  btn btn-danger fw-bold"  id="btn-eliminar" data-eliminar="${doc.id}">üóëÔ∏è</p>
                        <p class="col-4 btn btn-success fw-bold" id="btn-editar" data-editar="${doc.id}">‚úçÔ∏è</p>
                        <p class="col-4  btn btn-primary fw-bold" id="btn-ver" data-ver="${doc.id}" >üëÅÔ∏è‚Äçüó®Ô∏è</p>
                    </span>
                </div>
            </div>
            `           
            cont.innerHTML=html
            
            document.querySelectorAll("#btnImage").forEach((img)=>{
                img.addEventListener("click", function(evt){
                    document.getElementById("dialog-carrusel").showModal()
                    try {
                        slider.innerHTML=""
                        querySnapshot.forEach((doc)=>{
                    //alert(doc.id)
                        if(doc.id==img.dataset.ima){
                            //alert(doc.data().imagenes.principal)
                                slider.innerHTML =`
                        <div class="w-100 h-100 px-0 active d-flex justify-content-center">
                            <img src='${doc.data().imagenes.principal}' class="w-100 h-100 mt-5"  style="">
                        </div>
                    `
                        }
                   })   
                    } catch (error) {
                        alert(error)
                    }
                })
            })
           

            document.querySelectorAll("#btn-ver").forEach(elementVer=>{
              elementVer.addEventListener("click",({target:{dataset}})=>{

                  document.getElementById("ver-categorias").innerHTML=""
              document.getElementById("dialog-ver").showModal();

              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.ver){

              document.getElementById("ver-id").textContent=doc.id
              document.getElementById("ver-foto").src=doc.data().imagenes["principal"]
              document.getElementById("ver-nombre").value=doc.data().nombre
              document.getElementById("ver-marca").value=doc.data().marca
              document.getElementById("ver-cantidad").value=doc.data().cantidad
              document.getElementById("ver-detalles").textContent=doc.data().detalles
              document.getElementById("ver-observaciones").textContent=doc.data().observacion

              doc.data().categoria.forEach((badge)=>{
                      document.getElementById("ver-categorias").innerHTML +=`
                      <span id="badge" class="badge text-bg-${colores[Math.trunc(Math.random(0,6)*10)]}">${badge}</span>
                  `
                          })
                      }
                  })
              })
          })

            document.querySelectorAll("#btn-eliminar").forEach((element)=>{
          element.addEventListener("click",({target:{dataset}})=>{
          document.getElementById("dialog-eliminar").showModal()
          querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.eliminar){
                  document.getElementById("eliminar-id").textContent=doc.id
                  document.getElementById("eliminar-nombre").textContent=doc.data().nombre
                      }
                  })
              })
          })

          //BTN-EDITAR
            document.querySelectorAll("#btn-editar").forEach(elementEdit=>{

                document.querySelectorAll(".cat").forEach((gato)=>{
                    gato.checked=false
                })


            elementEdit.addEventListener("click",({target:{dataset}})=>{
              document.getElementById("dialog-editar").showModal();

              document.querySelectorAll(".cat").forEach((pro)=>{
                    pro.checked=false
            })
                
              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.editar){
                  document.getElementById("editar-id").textContent=doc.id
                  document.getElementById("editar-foto").src=doc.data().imagenes["principal"]
                  document.getElementById("editar-nombre").value=doc.data().nombre
                  document.getElementById("editar-marca").value=doc.data().marca
                  document.getElementById("editar-cantidad").value=doc.data().cantidad
                  document.getElementById("editar-detalles").textContent=doc.data().detalles
                  document.getElementById("editar-observaciones").textContent=doc.data().observacion
                    

                document.querySelectorAll(".cat").forEach((gato)=>{
                            doc.data().categoria.forEach((y)=>{
                                if(y==gato.dataset.categoria){
                                    gato.checked=true
                                    }
                                })
                            })
                        }
                    })
                })
            })

            value++
            
        })





    })
})


        document.getElementById("cerrar_carrusel").addEventListener("click",function(){
            //alert("carrusel cerrado!")    
            document.getElementById("dialog-carrusel").close()

        })

        function cerrar(e){
    
            document.getElementById("dialog-eliminar").close();
            document.getElementById("dialog-editar").close();
            document.getElementById("dialog-ver").close();
            e.preventDefault()
        }

        btnDel.addEventListener("click",(e)=>{
            eliminarProd(document.getElementById("eliminar-id").textContent)
            cerrar(e)
            alert("Producto Eliminado!")
        })
        

        let imagenUrl = "";

        document.getElementById("changePhoto").addEventListener("change",async function(evt){
            var file=evt.target.files[0]
            alert(file)
            if (file) {
            try {
                imagenUrl = await uploadFileToStorage(file);
                //alert(imagenUrl)
            } catch (uploadError) {
                console.error("Error subiendo imagen:", uploadError);
                throw new Error(`Error al subir la imagen: ${uploadError.message}`);
            }
            }
        })


        /*********************************************/
        /*FUNCION DE GUARDA IMAGENES*****************/
         // Funci√≥n mejorada para subir im√°genes
        async function uploadFileToStorage(file) {
        try {
            // Validaci√≥n del archivo
            if (!file) return null;
            
            if (!file.type.match('image.*')) {
            throw new Error('Solo se permiten archivos de imagen');
            }
            
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
            throw new Error('La imagen es demasiado grande (m√°ximo 5MB)');
            }

            // Subir el archivo
            const storageRef = ref(storage, `productos/${file.name}`);
            const snapshot = await uploadBytes(storageRef, file);
            
            // Obtener URL p√∫blica
            return await getDownloadURL(snapshot.ref);
        } catch (error) {
            console.error('Error en uploadFileToStorage:', error);
            throw error;
        }
        }

        //items.value=JSON.stringify(["sin categorias"])
        document.getElementById("selects").value=JSON.stringify(["sin categorias"])
        
        btnEditar.addEventListener("click", async function(evt){
        var categorias=[]
        
        document.querySelectorAll(".cat").forEach((cb_categorias)=>{
            if(cb_categorias.checked){
                categorias.push(cb_categorias.dataset.categoria)
            }
        })

        if(categorias.length==0){
            categorias=["sin categorias"]
        }
        //alert(JSON.stringify(categorias))
            if(imagenUrl==undefined || imagenUrl==null || imagenUrl==""){
                    try{
                const docRef=doc(db,"prueba",document.getElementById("editar-id").textContent)
                await updateDoc(docRef,{
                    nombre:document.getElementById("editar-nombre").value,
                    marca:document.getElementById("editar-marca").value,
                    cantidad:document.getElementById("editar-cantidad").value,
                    categoria:categorias,
                    detalles:document.getElementById("editar-detalles").value,
                    observacion:document.getElementById("editar-observaciones").value,
                    fecha:new Date()
                })
                    alert("producto actualizado!")
                    //window.location.reload()
                    cerrar()
            }catch(error){
                alert(error)
            }
            }else{
                try{
                const docRef=doc(db,"prueba",document.getElementById("editar-id").textContent)
                await updateDoc(docRef,{
                    nombre:document.getElementById("editar-nombre").value,
                    marca:document.getElementById("editar-marca").value,
                    cantidad:document.getElementById("editar-cantidad").value,
                    categoria:categorias,
                    detalles:document.getElementById("editar-detalles").value,
                    observacion:document.getElementById("editar-observaciones").value,
                    imagenes:{"principal":imagenUrl, "otras":["raton.png","raton(1).png"]},
                    fecha:new Date()
                })
                    document.getElementById("changePhoto").value=""
                    alert("producto actualizado!")
                    cerrar()
            }catch(error){
                alert(error)
            }
            }
        })


        closeDialogDel.addEventListener("click",(e)=>{
            cerrar(e)
        })

        closeDialogEdit.addEventListener("click", (e)=>{
            cerrar(e)
        })

        closeDialogVer.addEventListener("click",(e)=>{
            cerrar(e)
        })

        document.getElementById("selectCat").onchange=()=>{
            cbCategoria.checked=false
            contenido_buscar.disabled=false

            if(this.value=="--Todas las Categorias--"){
                cont.innerHTML=""
                listaProd((querySnapshot)=>{
                
                querySnapshot.forEach((doc)=>{
                    querySnapshot.forEach((doc)=>{
                    html +=`
                    <div class="card col-6 col-md-4 col-lg-3 col-xxl-2 rounded-3" id="card-prod">
                <div class="row d-flex justify-content-center  rounded-2">
                        <span class="
                        rounded-top-2 text-center fw-bold py-1 fs-4" id="nombre-productos"> ${doc.data().nombre} </span>
                        <span id="id_hidden">${doc.id}</span>
                        <img src=${doc.data().imagenes["principal"]} class="py-1" style="width: 8rem;" data-ima="${doc.id}" id="btnImage">
                </div>
                <div class="row rounded-2 p-0">
                    <span class="btn-group">
                        <p class="col-4 border btn btn-danger fw-bold"  id="btn-eliminar" data-eliminar="${doc.id}">üóëÔ∏è</p>
                        <p class="col-4 border btn btn-success fw-bold" id="btn-editar" data-editar="${doc.id}">‚úçÔ∏è</p>
                        <p class="col-4 border btn btn-primary fw-bold" id="btn-ver" data-ver="${doc.id}" >üëÅÔ∏è‚Äçüó®Ô∏è</p>
                    </span>
                </div>
            </div>
            `           
            cont.innerHTML=html
            
            document.querySelectorAll("#btnImage").forEach((img)=>{
                img.addEventListener("click", function(evt){
                    document.getElementById("dialog-carrusel").showModal()
                    try {
                        slider.innerHTML=""
                        querySnapshot.forEach((doc)=>{
                    //alert(doc.id)
                        if(doc.id==img.dataset.ima){
                            //alert(doc.data().imagenes.principal)
                                slider.innerHTML =`
                        <div class="w-100 h-100 px-0 active d-flex justify-content-center">
                            <img src='${doc.data().imagenes.principal}' class="w-100 h-100 mt-5"  style="">
                        </div>
                    `
                        }
                   })   
                    } catch (error) {
                        alert(error)
                    }
                })
            })
           

            document.querySelectorAll("#btn-ver").forEach(elementVer=>{
              elementVer.addEventListener("click",({target:{dataset}})=>{

                  document.getElementById("ver-categorias").innerHTML=""
              document.getElementById("dialog-ver").showModal();

              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.ver){

              document.getElementById("ver-id").textContent=doc.id
              document.getElementById("ver-foto").src=doc.data().imagenes["principal"]
              document.getElementById("ver-nombre").value=doc.data().nombre
              document.getElementById("ver-marca").value=doc.data().marca
              document.getElementById("ver-cantidad").value=doc.data().cantidad
              document.getElementById("ver-detalles").textContent=doc.data().detalles
              document.getElementById("ver-observaciones").textContent=doc.data().observacion

              doc.data().categoria.forEach((badge)=>{
                      document.getElementById("ver-categorias").innerHTML +=`
                      <span id="badge" class="badge text-bg-${colores[Math.trunc(Math.random(0,6)*10)]}">${badge}</span>
                  `
                          })
                      }
                  })
              })
          })

            document.querySelectorAll("#btn-eliminar").forEach((element)=>{
          element.addEventListener("click",({target:{dataset}})=>{
          document.getElementById("dialog-eliminar").showModal()
          querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.eliminar){
                  document.getElementById("eliminar-id").textContent=doc.id
                  document.getElementById("eliminar-nombre").textContent=doc.data().nombre
                      }
                  })
              })
          })

          //BTN-EDITAR
            document.querySelectorAll("#btn-editar").forEach(elementEdit=>{

                document.querySelectorAll(".cat").forEach((gato)=>{
                    gato.checked=false
                })


            elementEdit.addEventListener("click",({target:{dataset}})=>{
              document.getElementById("dialog-editar").showModal();

              document.querySelectorAll(".cat").forEach((pro)=>{
                    pro.checked=false
            })
                
              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.editar){
                  document.getElementById("editar-id").textContent=doc.id
                  document.getElementById("editar-foto").src=doc.data().imagenes["principal"]
                  document.getElementById("editar-nombre").value=doc.data().nombre
                  document.getElementById("editar-marca").value=doc.data().marca
                  document.getElementById("editar-cantidad").value=doc.data().cantidad
                  document.getElementById("editar-detalles").textContent=doc.data().detalles
                  document.getElementById("editar-observaciones").textContent=doc.data().observacion
                    

                document.querySelectorAll(".cat").forEach((gato)=>{
                            doc.data().categoria.forEach((y)=>{
                                if(y==gato.dataset.categoria){
                                    gato.checked=true
                                    }
                                })
                            })
                        }
                    })
                })
            })


            
        })
                })
            })
                
            }
        }
        
        var html2=""
        cbCategoria.addEventListener("change",function(){
            contenido_buscar.disabled=this.checked

            /*********************************
             ************************ver el memo y vaciar el campo de busqueda*/
            

            //alert(document.getElementById("selectCat").selectedOptions[0].label)
             listaProd((querySnapshot)=>{
                html2=""
                querySnapshot.forEach((doc)=>{
                    doc.data().categoria.forEach(productoC=>{
                        if(productoC==document.getElementById("selectCat").selectedOptions[0].label){
                             html2 +=`
                    <div class="card col-6 col-md-4 col-lg-3 col-xxl-2 rounded-3"} id="card-prod">
                <div class="row d-flex justify-content-center  rounded-2">
                        <span class="
                        rounded-top-2 text-center fw-bold py-1 fs-4" id="nombre-productos"> ${doc.data().nombre} </span>
                        <span id="id_hidden">${doc.id}</span>
                        <img src=${doc.data().imagenes["principal"]} class="py-1" style="width: 8rem;" data-img="${doc.id}" id="btnImage">
                </div>
                <div class="row rounded-2 p-0">
                    <span class="btn-group">
                        <p class="col-4 border btn btn-danger fw-bold"  id="btn-eliminar" data-eliminar="${doc.id}">üóëÔ∏è</p>
                        <p class="col-4 border btn btn-success fw-bold" id="btn-editar" data-editar="${doc.id}">‚úçÔ∏è</p>
                        <p class="col-4 border btn btn-primary fw-bold" id="btn-ver" data-ver="${doc.id}" >üëÅÔ∏è‚Äçüó®Ô∏è</p>
                    </span>
                </div>
            </div>
            `    
                        }
                    })
                    cont.innerHTML=html2

                    var sliderhtml=""
            document.querySelectorAll("#btnImage").forEach((img)=>{
                img.addEventListener("click", function(evt){
                    document.getElementById("dialog-carrusel").showModal()
                    sliderhtml=""
                querySnapshot.forEach((doc)=>{
                    if(doc.id==evt.target.dataset.ima){
                        doc.data().imagenes.otras.forEach(dat=>{
                            sliderhtml +=`
                        <div class="carousel-item">
                            <img src="./../src/styles/img/${dat}" class="d-block">
                        </div>
                    `
                        })
                        slider.innerHTML=sliderhtml
                        document.querySelectorAll(".carousel-item")[0].classList.add("active")
                    }
                })
                })
            })
            

            document.querySelectorAll("#btn-ver").forEach(elementVer=>{
              elementVer.addEventListener("click",({target:{dataset}})=>{

                  document.getElementById("ver-categorias").innerHTML=""
              document.getElementById("dialog-ver").showModal();

              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.ver){

              document.getElementById("ver-id").textContent=doc.id
              document.getElementById("ver-foto").src=doc.data().imagenes["principal"]
              document.getElementById("ver-nombre").value=doc.data().nombre
              document.getElementById("ver-marca").value=doc.data().marca
              document.getElementById("ver-cantidad").value=doc.data().cantidad
              document.getElementById("ver-detalles").textContent=doc.data().detalles
              document.getElementById("ver-observaciones").textContent=doc.data().observacion

              doc.data().categoria.forEach((badge)=>{
                      document.getElementById("ver-categorias").innerHTML +=`
                      <span id="badge" class="badge text-bg-${colores[Math.trunc(Math.random(0,6)*10)]}">${badge}</span>
                  `
                          })
                      }
                  })
              })
          })

            document.querySelectorAll("#btn-eliminar").forEach((element)=>{
          element.addEventListener("click",({target:{dataset}})=>{
          document.getElementById("dialog-eliminar").showModal()
          querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.eliminar){
                  document.getElementById("eliminar-id").textContent=doc.id
                  document.getElementById("eliminar-nombre").textContent=doc.data().nombre
                      }
                  })
              })
          })

            document.querySelectorAll("#btn-editar").forEach(elementEdit=>{

                document.querySelectorAll(".cat").forEach((gato)=>{
                    gato.checked=false
                })


            elementEdit.addEventListener("click",({target:{dataset}})=>{
              document.getElementById("dialog-editar").showModal();

              document.querySelectorAll(".cat").forEach((pro)=>{
                    pro.checked=false
            })
                
              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.editar){
                  document.getElementById("editar-id").textContent=doc.id
                  document.getElementById("editar-foto").src=doc.data().imagenes["principal"]
                  document.getElementById("editar-nombre").value=doc.data().nombre
                  document.getElementById("editar-marca").value=doc.data().marca
                  document.getElementById("editar-cantidad").value=doc.data().cantidad
                  document.getElementById("editar-detalles").textContent=doc.data().detalles
                  document.getElementById("editar-observaciones").textContent=doc.data().observacion
                    

                document.querySelectorAll(".cat").forEach((gato)=>{
                            doc.data().categoria.forEach((y)=>{
                                if(y==gato.dataset.categoria){
                                    gato.checked=true
                                    }
                                })
                            })
                        }
                    })
                })
            })
                })
            })
        })

        let memo=0
        var html=""
        contenido_buscar.addEventListener("keyup",function(e){
            var filtroCategoria=document.getElementById("selectCat")
            var filtroMarca=document.getElementById("selectMarc")
            html=""
            if(e.keyCode==8 && contenido_buscar.value==""){
                //window.location.reload()
            }
            //evitar que se pegue un texto(Ctrl+v)
            if(e.keyCode==17){
                contenido_buscar.value=""
                memo=0
            }
            if(e.keyCode==8){
                if(memo>0){
                memo -=1
                }
            }else{
                memo ++
            }
            
            listaProd((querySnapshot)=>{
                querySnapshot.forEach((doc)=>{
                    if(doc.data().nombre.slice(0,memo)==contenido_buscar.value){
                        
                         if(filtroCategoria.selectedOptions[0].label=="--Todas las Categorias--" || contenido_buscar.value==""){
                                //filtroCategoria.value="--Todas las Categorias--"
                                html +=`
                    <div class="card col-6 col-md-4 col-lg-3 col-xxl-2 rounded-3"} >
                <div class="row d-flex justify-content-center  rounded-2">
                        <span class="
                        rounded-top-2 text-center fw-bold py-1 fs-4" id="nombre-productos"> ${doc.data().nombre} </span>
                        <span id="id_hidden">${doc.id}</span>
                        <img src=${doc.data().imagenes["principal"]} class="py-1" style="width: 8rem;" data-img="${doc.id}" id="btnImage">
                </div>
                <div class="row rounded-2 p-0">
                    <span class="btn-group">
                        <p class="col-4 border btn btn-danger fw-bold"  id="btn-eliminar" data-eliminar="${doc.id}">üóëÔ∏è</p>
                        <p class="col-4 border btn btn-success fw-bold" id="btn-editar" data-editar="${doc.id}">‚úçÔ∏è</p>
                        <p class="col-4 border btn btn-primary fw-bold" id="btn-ver" data-ver="${doc.id}" >üëÅÔ∏è‚Äçüó®Ô∏è</p>
                    </span>
                </div>
            </div>
            `    
                            }

                        doc.data().categoria.forEach((item)=>{
                        if(filtroCategoria.selectedOptions[0].label==item ){
                    html +=`
                    <div class="card col-6 col-md-4 col-lg-3 col-xxl-2 rounded-3 border border-warning border-2"} >
                <div class="row d-flex justify-content-center  rounded-2">
                        <span class=" border
                        border-secondary border-top-0 
                        border-start-0
                        border-end-0
                        border-bottom-1
                        rounded-top-2 text-center fw-bold bg-warning py-1 fs-4" id="nombre-productos"> ${doc.data().nombre} </span>
                        <span id="id_hidden">${doc.id}</span>
                        <img src=${doc.data().imagenes["principal"]} class="py-1" style="width: 8rem;" data-img="${doc.id}" id="btnImage">
                </div>
                <div class="row rounded-2 p-0">
                    <span class="btn-group">
                        <p class="col-4 border btn btn-danger fw-bold"  id="btn-eliminar" data-eliminar="${doc.id}">üóëÔ∏è</p>
                        <p class="col-4 border btn btn-success fw-bold" id="btn-editar" data-editar="${doc.id}">‚úçÔ∏è</p>
                        <p class="col-4 border btn btn-primary fw-bold" id="btn-ver" data-ver="${doc.id}" >üëÅÔ∏è‚Äçüó®Ô∏è</p>
                    </span>
                </div>
            </div>
            `           
        }
            cont.innerHTML=html
            //carrusel
            //cerrar_carrusel

             var sliderhtml=""
            document.querySelectorAll("#btnImage").forEach((img)=>{
                img.addEventListener("click", function(evt){
                    document.getElementById("dialog-carrusel").showModal()
                    sliderhtml=""
                querySnapshot.forEach((doc)=>{
                    if(doc.id==evt.target.dataset.ima){
                        doc.data().imagenes.otras.forEach(dat=>{
                            sliderhtml +=`
                        <div class="carousel-item">
                            <img src="./../src/styles/img/${dat}" class="d-block">
                        </div>
                    `
                        })
                        slider.innerHTML=sliderhtml
                        document.querySelectorAll(".carousel-item")[0].classList.add("active")
                    }
                })
                })
            })
            

            document.querySelectorAll("#btn-ver").forEach(elementVer=>{
              elementVer.addEventListener("click",({target:{dataset}})=>{

                  document.getElementById("ver-categorias").innerHTML=""
              document.getElementById("dialog-ver").showModal();

              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.ver){

              document.getElementById("ver-id").textContent=doc.id
              document.getElementById("ver-foto").src=doc.data().imagenes["principal"]
              document.getElementById("ver-nombre").value=doc.data().nombre
              document.getElementById("ver-marca").value=doc.data().marca
              document.getElementById("ver-cantidad").value=doc.data().cantidad
              document.getElementById("ver-detalles").textContent=doc.data().detalles
              document.getElementById("ver-observaciones").textContent=doc.data().observacion

              doc.data().categoria.forEach((badge)=>{
                      document.getElementById("ver-categorias").innerHTML +=`
                      <span id="badge" class="badge text-bg-${colores[Math.trunc(Math.random(0,6)*10)]}">${badge}</span>
                  `
                          })
                      }
                  })
              })
          })

            document.querySelectorAll("#btn-eliminar").forEach((element)=>{
          element.addEventListener("click",({target:{dataset}})=>{
          document.getElementById("dialog-eliminar").showModal()
          querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.eliminar){
                  document.getElementById("eliminar-id").textContent=doc.id
                  document.getElementById("eliminar-nombre").textContent=doc.data().nombre
                      }
                  })
              })
          })

             document.querySelectorAll("#btn-editar").forEach(elementEdit=>{
                document.querySelectorAll(".cat").forEach((gato)=>{
                    gato.checked=false
                })


            elementEdit.addEventListener("click",({target:{dataset}})=>{
              document.getElementById("dialog-editar").showModal();

              document.querySelectorAll(".cat").forEach((pro)=>{
                    pro.checked=false
            })
                
              querySnapshot.forEach((doc)=>{
              if(doc.id==dataset.editar){
                  document.getElementById("editar-id").textContent=doc.id
                  document.getElementById("editar-foto").src=doc.data().imagenes["principal"]
                  document.getElementById("editar-nombre").value=doc.data().nombre
                  document.getElementById("editar-marca").value=doc.data().marca
                  document.getElementById("editar-cantidad").value=doc.data().cantidad
                  document.getElementById("editar-detalles").textContent=doc.data().detalles
                  document.getElementById("editar-observaciones").textContent=doc.data().observacion
                    

                document.querySelectorAll(".cat").forEach((gato)=>{
                            doc.data().categoria.forEach((y)=>{
                                if(y==gato.dataset.categoria){
                                    gato.checked=true
                                            }
                                        })
                                    })
                                }
                            })
                        })
                    })
                })
            }
        })
    })
})

    </script>
    
</body>
</html>
